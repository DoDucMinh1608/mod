var maps = [
  "                                                   3959344792                   \n" +
  "                                   718986124913973613462771413524               \n" +
  "                                   7669946824123196795988179833732      8976678 \n" +
  "   36279                           5591122198568942622    1831693666    7747294 \n" +
  "   62876                                                      4619769   1143455 \n" +
  "   67722            7153437     133                       865349411351  2211952 \n" +
  "   19542            1458991     712    96547326295        28513  39686  9513819 \n" +
  "   87526            4681366     382    96268286388        24351    467  6552632 \n" +
  "                    5755425            67192651253        95366    136  8893844 \n" +
  "                    8352187            61535323398        35171                 \n" +
  "         747536981  6741434      749   65931317141                              \n" +
  "         642662399  94672114526  494   54719717537                              \n" +
  "         237244268      7669293  122   91813255544                              \n" +
  "         311612893      6948516  291   56395581374                              \n" +
  "         843492743      5452195  3793  13981125533                              \n" +
  "    154  891125631      9516439  8137  95587847328           78969839197        \n" +
  "    847  726777499      1389898  9945  66781126589           18138985389   934  \n" +
  "    635  425915326      7455581   3685                       96117168417   552  \n" +
  "         395377679                8228                       11834219969   276  \n" +
  "                                  14899                      77715568213   294  \n" +
  "                                   7345               24549  18893345716   4399 \n" +
  "                                   32719              61155  17892221521   4247 \n" +
  "      72835                         3382              13185  57714825516   7531 \n" +
  "      12539   893     63263751354   2166              57754  54597795619    556 \n" +
  "      74358   647     45183615172    251  4119626     48376  98712754258    696 \n" +
  "      83558   258     43431918128    317  7196649            85483556494    5261\n" +
  "      82622           99144373228         9735262                           1555\n" +
  "                      79164879483         5956981                           6644\n" +
  "                      96491744867         6248256     6973          1678828  962\n" +
  "                      44576954885         5712954     6713          8373382  145\n" +
  "  451       793       39255959252         5999797   658636          2447162  646\n" +
  "  522       962       75831824191                  381417           2745128  749\n" +
  "  318       332       29729526474   766          5163344 3399556    4961996  475\n" +
  "                      46994753389   734     11746145631  3239358    5863727  634\n" +
  "                                    763733722568872148   2133676    4465338  489\n" +
  " 961245123            785             83732696712596     1676387            5688\n" +
  " 524295887            452             37128789           7526741            2539\n" +
  " 894777594            135             181            359 6795946            4799\n" +
  " 145874325     65848                       384926789 258 9953763            366 \n" +
  " 264565928     32716                       298361421 675                    391 \n" +
  " 522581575     85675                       411426542 622          912419378     \n" +
  " 176326934     86442      1619231          753438247 214          594269624     \n" +
  " 742455288     97145      9562892          714882796 561          786487351     \n" +
  " 856261968                1481712          528258964 847          426868682     \n" +
  "                91497     5473592          934838699 865  717     324872281     \n" +
  "                25372     6829869  292     593346825 618  191     278524483     \n" +
  "          385   19141     3245518  371     794673982 829  534     666718999     \n" +
  "          272   39463     1595895  499               2381         114194531     \n" +
  "          481                                        4772         839172164     \n" +
  "                                                     7169                       \n" +
  "                45975364396                                                     \n" +
  "                21497738683               53552                                 \n" +
  "                78114551732               44398   241                           \n" +
  "                84744671934               37772   118     78537893675           \n" +
  "    63747       34552724918               42477   161     36365176714           \n" +
  "    68319       99829972612        913    12145           46692542931           \n" +
  "    28287       46491779639        458                    16112349479    951    \n" +
  "    47665       91472158461        228                    16684179835    461    \n" +
  "    86814       45514383413                               14823274933    338    \n" +
  "                67553966948            3824113            96312874699           \n" +
  "                41994926643            6327782    844     71171985928           \n" +
  "                                       4449189    689     77633242158           \n" +
  "                                       2456457    148     34242413246           \n" +
  "                           8462        5588393            38512752513           \n" +
  "                 65431     38686586    4132378                               989\n" +
  "                 36974     33571516728 4362351                        8279133279\n" +
  "                 31484       4646157221171                   6693523889571285922\n" +
  "                 17646          481911535374768856837627888343211269982659899788\n" +
  "                 72953             34287984139181689277681815214573324838       \n" +
  "                                       236715986696281216236524                 \n" +
  "                                                                                \n" +
  "                                                                                \n" +
  "                                                                                \n" +
  "                                                                                \n" +
  "                                                                                \n" +
  "                                                                                \n" +
  "                                                                                \n" +
  "                                                                                \n" +
  "                                                                                \n" +
  "                                                                                ",
  "                 9481            861            354         2636                \n" +
  "                 19185           9658           2151        34986               \n" +
  "      6489       972584          67756          61993       562516              \n" +
  "      37795       7324679         17543          16597        861583            \n" +
  "      856732       3284399         574614        8717132      7192341           \n" +
  "       5453739       5659516        681476         521326      28319364         \n" +
  "        1348421       6164361        7333164        2787665      7232677        \n" +
  "11        863922        999494         2276699        7276444      656738       \n" +
  "4335       276743         84824         6465395        5796681      4597149     \n" +
  "75637       368524        6953491          4869243      796525       9728811    \n" +
  "36375856     7591577        3564482         941183586      895         987519   \n" +
  " 351942441    2484118        21475488         9261262125          88    659198  \n" +
  "   969396829   2934312         77423373          277623885         79    6591288\n" +
  "59    1924321    22189523       159267283          996955264        64     17277\n" +
  " 68     8844913   53914549        798847899           82313594        9     1764\n" +
  "4738     9674944    95729928        52833356            1318847        369   712\n" +
  "315388     381928     69552498        628862              5664294        2781 79\n" +
  "6162824     836849     52846747         5179               69797767         198 \n" +
  " 5966327     1842177     27134964              789           1816724          22\n" +
  "  1856768      947284      87544954            527             8165875         4\n" +
  "   73699438     112249      85669848           416               6128696        \n" +
  "     75926162     3467118     49638589           7    934         2154361       \n" +
  "      66177 7948  5457984       8899219          3    25448         222765      \n" +
  "       64528   787  81424        3769878         29   6426346        8856933    \n" +
  "        37998    9583              2947761        915 95981121         312738   \n" +
  "         869895     434             4683873         7   58771646        939989  \n" +
  "11        1819343     659  35         5252714       26    84929771       517763 \n" +
  "252        8716975      1791           62672784      47    17269713       514457\n" +
  "89364        1493296           7314      25436551      32     6193542      79599\n" +
  "926377         938237          18928       41982144     165    4566347       423\n" +
  " 6662977        684544         8981559      45936389      74     7318413      71\n" +
  "   234191         429261        9614368       11462217      864   1169715       \n" +
  "    443686         3337658       913279398      3116358       462   3547936     \n" +
  "     8183431        36759747       159642298      455364        36   576118     \n" +
  "       4878138        427341881      78549934      2915421       79    56886    \n" +
  "112     516919          32636187       833293       2234734       729   22623   \n" +
  "1347     31166            6989912693     4426         59468677      13   76558  \n" +
  "3829                         51238295                  79867143       81  7298  \n" +
  " 72762                         799958178          387    2558987       73 2362  \n" +
  "  4215                            98775296        239      7818775      37      \n" +
  "  17956                            378473828      143       85948495     35     \n" +
  "   65773    2       265               5937761            5    64882336    89    \n" +
  "    35161    9      9911               3971877            9     5469334     5   \n" +
  "     6572     57    42639                3899658           53    49673432   92  \n" +
  "4     4931     58   295458                58793119          373    41931799     \n" +
  "19    67324      13   73311      9581       48163855           38    25519982   \n" +
  " 227   36118      91   193983       38       351769947           9541  7332384  \n" +
  "   59   89752      24   941563        52        94531889            838  3245353\n" +
  "    27   35576       64   613635        54        66457462             492979142\n" +
  "      89  96371       37  91114966       527       817394967             78 1644\n" +
  "       68  786777       45  8875562        258       163221495            232964\n" +
  " 698    86  34897        574  781588         9938       18198269            66  \n" +
  " 142     96  165388        51   855291          5583      48876646           37 \n" +
  " 348      46  366971         981 6648279           4916     656331652         13\n" +
  " 5369      64  5857612         86 1717974             46      779456967        8\n" +
  " 74576      93   561691         595 2856235            313      78511576        \n" +
  " 614685      33   68445337           13612968            429       695241       \n" +
  "  543453       16  898279657           2392357             833      2398874     \n" +
  "   6589272      69    51742339458        372341              6        141849    \n" +
  "    3638438      944    3284156164        9835444                      99632181 \n" +
  "9     8431844      888    32886545          55589426                    48594627\n" +
  " 15    3683189       915       765           472587668          321       926292\n" +
  "  19     5245195                               93786792         1285        7375\n" +
  "    43     8346949                                99965591      31323         44\n" +
  "     141    9327321                                474325972    337733  21      \n" +
  "       92    46366355       171                      85423246     4593   738    \n" +
  "847     43     79884636     953              295       1664726     27135   79   \n" +
  "9226      89     6183288    811    625       2748        13532     49988    246 \n" +
  "85325      783    487777    649    1181      54462         968      655697    66\n" +
  "897699       77     9479    339    833823    977538                  46518      \n" +
  " 542652       11            7699    627842    718971         32       26169     \n" +
  "   769362      54           3847     8231651   4417993        939      37656    \n" +
  "   4797577       31         86746     1788246   22758337        842     59352   \n" +
  "     4684789      26         3174       8418391  71667692         267   574923  \n" +
  "      4582427      954        2493        444158   676846478        21   195666 \n" +
  "       92559356      39       2365         7857962    38267953       33   557154\n" +
  "         3292341      972     71823         8717392    26879279       54   31984\n" +
  "           6212456      147    86217          219626     81812792      28   7245\n" +
  "            3729926       96   77739           4891594     2659148      34   497\n" +
  "              56712        97   8581            331754       73354       38   99",
];
var Spectator_102 = '{"name":"Spectator","level":1,"model":2,"size":0.025,"zoom":0.075,"specs":{"shield":{"capacity":[1e-30,1e-30],"reload":[1000,1000]},"generator":{"capacity":[1e-30,1e-30],"reload":[1,1]},"ship":{"mass":1,"speed":[200,200],"rotation":[1000,1000],"acceleration":[1000,1000]}},"bodies":{"face":{"section_segments":100,"angle":0,"offset":{"x":0,"y":0,"z":0},"position":{"x":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"y":[-2,-2,2,2],"z":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},"width":[0,1,1,0],"height":[0,1,1,0],"vertical":true,"texture":[6]}},"typespec":{"name":"Spectator","level":1,"model":2,"code":102,"specs":{"shield":{"capacity":[1e-30,1e-30],"reload":[1000,1000]},"generator":{"capacity":[1e-30,1e-30],"reload":[1,1]},"ship":{"mass":1,"speed":[200,200],"rotation":[1000,1000],"acceleration":[1000,1000]}},"shape":[0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001,0.001],"lasers":[],"radius":0.001}}';
var ships = [Spectator_102];
this.options = {
  auto_assign_teams: true,
  ships: ships,
  root_mode: 'team',
  max_players: 30,
  crystal_value: 3,
  starting_ship: 800,
  asteroids_strength: 0.5,
  speed_mod: 1.25,
  release_crystal: true,
  mines_self_destroy: false,
  projectile_speed: 1.2,
  hues: [180, 360],//[180, 120, 360],
  station_size: 1,
  station_crystal_capacity: 0.5,
  friendly_colors: 2,
  custom_map: maps[Math.trunc(Math.random() * maps.length)],
  map_size: 80
};
function sortTeam(game, number = 2) {
  let result = new Array(number).fill(0).map(i => Array);
  for (let i = 0; i < number; i++) {
    result[i] = game.ships.map(ship => { if (ship.team === i) return ship; }).filter((value, index, array) => value !== undefined);
  }
  return result;
};
const upgrades = [
  { id: "9", position: [25, 0, 20, 10], visible: true, clickable: true, shortcut: "9", components: [{ type: "box", position: [0, 0, 100, 100] }] },
  { id: "0", position: [45, 0, 20, 10], visible: true, clickable: true, shortcut: "0", components: [{ type: "box", position: [0, 0, 100, 100] }] }
];
const Gem = {
  id: 'gem',
  position: [66.4, 0, 6.6, 4],
  clickable: true,
  components: [
    { type: "box", position: [0, 0, 100, 100], fill: "rgba(68, 85, 102, 0)", stroke: "#cde", width: 5 },
    { type: "text", position: [0, 5, 100, 80], value: "Gem", color: "#cde" },
    { type: "box", position: [0, 85, 100, 15], fill: '#0ff' },  // bar
    { type: "box", position: [0, 85, 0, 15], fill: '#f00' }    // progress bar
  ]
};
const Spectator = {
  id: 'spectator',
  position: [73, 0, 6.6, 4],
  clickable: true,
  components: [
    { type: "box", position: [0, 0, 100, 100], fill: "rgba(68, 85, 102, 0)", stroke: "#cde", width: 5 },
    { type: "text", position: [5, 5, 90, 75], value: "Spectator", color: "#cde" },
    // button cooldown 
    { type: "box", position: [0, 85, 100, 15], fill: '#0ff' },  // bar 
    { type: "box", position: [0, 85, 0, 7.5], fill: '#FFA500' }, // progress effect
    { type: "box", position: [0, 92.5, 0, 7.5], fill: '#f00' } // progress cooldown
  ]
};
const ToogleMap = {
  id: 'map toogle',
  position: [59.8, 0, 6.6, 4],
  clickable: true,
  components: [
    { type: "box", position: [0, 0, 100, 100], fill: "rgba(68, 85, 102, 0)", stroke: "#cde", width: 5 },
    { type: "text", position: [0, 5, 100, 90], value: "Map", color: "#cde" },
  ]
};
const LEADER = {
  // spectator
  spectator: Spectator,
  spectator_delay: 0,       // button cooldown
  time_uses_spectator: 0,   // how long effect
  end_time_spectator: 0,          //time end the spectator
  spectator_activated: 0,         // time activated button
  spectator_allowed_time: 0,      // time end the spectator 
  is_spectator: false,
  // gem
  gem: Gem,
  gem_delay: 0,             // button cooldown
  gem_activated: 0,
  gem_cooldown_time: 0,
  value: 0,
  // players list
  allies: [],
  enemy: [],
  // map
  view_map: false,
  map: {
    id: 'map',
    position: [25, 5, 85 * 0.5625, 85],
    components: [{ type: 'box', position: [0, 0, 100, 100], fill: 'rgba(100, 100, 100, 0.5)' }]
  },
  toggle_map: ToogleMap
};
function SetupLeader(ship) {
  if (!ship.custom.leader) {
    Object.assign(ship.custom, LEADER);
    ship.setUIComponent(ship.custom.spectator);
    ship.setUIComponent(ship.custom.gem);
    ship.setUIComponent(ship.custom.toggle_map);
    ship.custom.leader = true;
    ship.custom.spectator_delay = 5 * 60 ** 2;
    ship.custom.time_uses_spectator = 1.5 * 60 ** 2;
    ship.custom.gem_delay = 5 * 60 ** 2;
  }
}
function LeaderCode(ship) {
  if (ship.custom.leader) {
    // effect cooldown bar
    if (game.step <= ship.custom.end_time_spectator) {
      let time = ship.custom.end_time_spectator - game.step;
      ship.custom.spectator.components[3].position[2] = (time / ship.custom.time_uses_spectator) * 100;
    } else ship.custom.spectator.components[3].position[2] = 0;
    if (game.step <= ship.custom.spectator_allowed_time) {
      let time = ship.custom.spectator_allowed_time - game.step;
      ship.custom.spectator.components[4].position[2] = (time / ship.custom.spectator_delay) * 100;
    } else ship.custom.spectator.components[4].position[2] = 0;
    ship.setUIComponent(ship.custom.spectator);
    // remove effect after time
    if (ship.custom.is_spectator && game.step > ship.custom.end_time_spectator) {
      ship.set(ship.custom.stats);
      ship.custom.is_spectator = false;
    }
    // gem effect
    if (game.step < ship.custom.gem_cooldown_time) {
      let time = ship.custom.gem_cooldown_time - game.step;
      ship.custom.gem.components[3].position[2] = (time / ship.custom.gem_delay) * 100;
    } else ship.custom.gem.components[3].position[2] = 0;
    ship.setUIComponent(ship.custom.gem);
  }
}
this.tick = function (game) {
  if (game.step % 60 === 0) {
    ([team1, team2] = sortTeam(game));
    game.ships.forEach((ship, index) => {
      SetupLeader(ship);
    });
  }
  if (game.step % 45 === 0) {
    game.ships.forEach((ship, index) => {
      LeaderCode(ship);
    });
  }
};
this.event = function (event, game) {
  let ship = event.ship;
  let custom = ship.custom;
  switch (event.id) {
    case 'spectator':
      !custom.is_spectator && (custom.stats = { type: ship.type, stats: ship.stats, collider: true, shield: ship.shield, generator: ship.generator, crystals: ship.crystals, invulnerable: 120 });
      if (!custom.is_spectator && game.step >= custom.spectator_allowed_time) {
        custom.spectator_activated = game.step;
        custom.spectator_allowed_time = game.step + custom.spectator_delay;
        custom.end_time_spectator = game.step + custom.time_uses_spectator;
        custom.is_spectator = true;
        ship.set({ type: 102, collider: false });
        for (let upgrade of upgrades) ship.setUIComponent(upgrade);
      } else if (custom.is_spectator) {
        ship.set(custom.stats);
        custom.is_spectator = false;
        custom.end_time_spectator = game.step;
        for (let upgrade of upgrades) ship.setUIComponent({ id: upgrade.id, visble: false });
      }
      break;
    case 'gem':
      if (game.step > custom.gem_cooldown_time) {
        value = custom.leader ? 1 : 0.5;
        custom.value = Math.trunc(ship.type / 100) ** 2 * 5 * 4 * value;
        ship.set({ crystals: ship.crystals + custom.value });
        custom.gem_activated = game.step;
        custom.gem_cooldown_time = game.step + custom.gem_delay;
      }
      break;
    case 'map toogle':
      custom.view_map = !custom.view_map;
      if (custom.view_map) {
        ship.setUIComponent(custom.map);
      } else ship.setUIComponent({ id: 'map', visible: false });
      break;
  }
  switch (event.name) {
    case 'ship_destroyed':

      break;
    case 'ship_spawned':
      break;
    default:
      break;
  }
};







































